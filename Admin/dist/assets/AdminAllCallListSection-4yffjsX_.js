import{u as v,r as c,a as S,j as t,F as h,b as f,c as C,d as I,e as k,f as A,g as _}from"./index-BsPeETtX.js";const F=()=>{const{currentAdmin:a}=v(e=>e.admin),[m,g]=c.useState([]),{socket:j,setIsVideoCall:p}=S(),[r,x]=c.useState(1),[l,N]=c.useState(0),u=async(e=!1,s,i,n)=>{try{p(e);const d=await(await fetch("/api/start_call",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({callData:{conversationId:s,callerId:a._id,adminId:a._id,userId:i,caller:"Admin",callType:e?"video":"audio",receiver:"User"},token:n,username:a.username})})).json();d._id&&j.emit("incoming-call",{conId:s,incommingId:a._id,adminId:a._id,callerId:d._id})}catch(o){console.error("Error starting call:",o)}};function w(e){const s=Math.floor(e/1e3%60),i=Math.floor(e/(1e3*60)%60),n=Math.floor(e/(1e3*60*60)%24),o=s<10?`0${s}`:s.toString(),d=i<10?`0${i}`:i.toString(),y=n<10?`0${n}`:n.toString();return n===0?`${d}:${o}`:`${y}:${d}:${o}`}const b=async()=>{try{const s=await(await fetch(`/api/get_calls/${a._id}/${r}`)).json();console.log(s),s&&(g(s.calls),N(Math.ceil(s.totalCalls/10)))}catch(e){console.log(e)}};return c.useEffect(()=>{b()},[r]),t.jsxs("div",{className:"container mx-auto flex flex-col",children:[t.jsxs("div",{className:"p-4 w-full h-full border-2 rounded-lg shadow-lg bg-white",children:[t.jsx("div",{className:"flex justify-between h-full items-center px-5 py-2 border-b cursor-pointer",children:t.jsx("h2",{className:"text-2xl font-bold",children:"All Calls"})}),t.jsx("div",{className:"overflow-y-scroll max-h-[540px]",children:m&&m.map(e=>{var s;return t.jsxs("div",{className:"flex items-center h-[70px] rounded-lg justify-between border-b mt-2 p-2 hover:bg-gray-100",children:[t.jsxs("div",{className:"flex flex-col w-2/3",children:[t.jsx("span",{className:"text-xs md:text-sm text-gray-500",children:new Date(e.createdAt).toLocaleString()}),t.jsx("span",{className:"text-sm md:text-lg font-semibold",children:(s=e==null?void 0:e.userId)==null?void 0:s.username}),t.jsxs("div",{className:"flex items-center gap-3 text-xs md:text-sm text-gray-500",children:[e.caller==="Admin"?t.jsx(h,{className:"text-blue-500"}):t.jsx(f,{className:"text-green-500"}),t.jsx("span",{children:e.caller==="Admin"?"Outgoing":"Incoming"}),t.jsx("span",{children:(e==null?void 0:e.callDuration)&&t.jsxs(t.Fragment,{children:["Call Duration: ",w(e==null?void 0:e.callDuration)]})})]})]}),t.jsxs("div",{className:"flex flex-col items-center gap-1 w-1/3",children:[t.jsx("div",{className:"flex items-center gap-2",children:e.callType==="video"?t.jsx(C,{onClick:()=>u(!0,e.conversationId,e.userId._id,e.userId.fcmToken),className:"cursor-pointer text-red-500"}):t.jsx(h,{onClick:()=>u(!1,e.conversationId,e.userId._id,e.userId.fcmToken),className:"cursor-pointer text-green-500"})}),t.jsxs("div",{className:"flex items-center gap-2",children:[e.callStatus==="answered"&&t.jsx(I,{className:"text-green-500"}),e.callStatus==="declined"&&t.jsx(k,{className:"text-red-500"}),e.callStatus!=="answered"&&e.callStatus!=="declined"&&t.jsx(f,{className:"text-yellow-500"}),t.jsx("span",{className:"text-xs md:text-sm",children:e.callStatus==="answered"?"Answered":e.callStatus==="declined"?"Declined":"Missed"})]})]})]},e._id)})})]}),t.jsxs("div",{className:"flex justify-between items-center mt-4",children:[t.jsx("button",{className:"p-2 bg-sky-500 text-white rounded",onClick:()=>x(e=>Math.max(e-1,1)),disabled:r===1,children:t.jsx(A,{})}),t.jsxs("span",{children:["Page ",r," of ",l]}),t.jsx("button",{className:"p-2 bg-sky-500 text-white rounded",onClick:()=>x(e=>Math.min(e+1,l)),disabled:r===l,children:t.jsx(_,{})})]})]})};export{F as default};
